USE [Sap_Approval]
GO
/****** Object:  StoredProcedure [dbo].[GetTrn_201_202_Movement]    Script Date: 30-04-2025 11:50:30 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[GetTrn_201_202_Movement]
AS
BEGIN
    SET NOCOUNT ON;

    SELECT 
        T.Trn_201_202_ID,
        D.Doc_ID,
        P.Plant_Code,
        M.Material_Code,
        M.Description AS Material_Description,
        T.Quantity AS Qty,
        S.Storage_Code AS SLoc_Code,
        MT.Movement_Code AS Movement_Type,
        CC.CostCenter_Code,
        T.Valuation_Type,
        T.Batch,
        T.Rate_Unit,
        T.Remark,
        -- Optional Status Fields (if you have them in the table)
        D.Approval_Status,
        D.Status AS Status,
        CONVERT(VARCHAR(10), T.Created_On, 103) AS Date
    FROM Trn_201_202_Movement T
    INNER JOIN Mst_Plant P ON T.Plant_ID = P.Plant_ID
    INNER JOIN Mst_Material M ON T.Material_ID = M.Material_ID
    INNER JOIN Mst_Storage_Location S ON T.SLoc_ID = S.SLoc_ID
    INNER JOIN Mst_Movement_Type MT ON T.Movement_ID = MT.Movement_ID
    INNER JOIN Mst_Cost_Center CC ON T.CostCenter_ID = CC.CostCenter_ID
    INNER JOIN Trn_Document D ON T.Doc_ID = D.Doc_ID;
END;
